#{extends 'main.html' /}
#{set title:'Home' /}
#{set timeTableNavActive:'active' /}
#{set myCoursesNavActive: '' /}

#{set 'pageStyles'}
  <link href="@{'/public/stylesheets/fullcalendar.css'}" rel='stylesheet' />
  <link href="@{'/public/stylesheets/fullcalendar.print.css'}" rel='stylesheet' media='print' />
  <style>

  #calendar {
    margin: 0 auto;
    }

  </style>     
#{/set}
#{set 'pageScripts'}
  <script src="@{'/public/javascripts/fullcalendar.min.js'}"></script>
  <script>

  $(document).ready(function() {
  
    var date = new Date();
    var d = date.getDate();
    var m = date.getMonth();
    var y = date.getFullYear();
    
    $('#calendar').fullCalendar({
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay'
      },
      defaultView: 'agendaWeek',
      slotminutes: 60,
      editable: false,
      events: [
  %{
    i = 0;
    for(entry in entryList){
      i++; 
      println '{';
      println 'title: \''+entry.getTitle()+'\',';
      if(entry.getEntryType()==models.timetable.TimetableEntry.TimetableEntryType.BLOCKED){
        println 'color: \'#dddddd\','
      }
      else if(entry.getEntryType()==models.timetable.TimetableEntry.TimetableEntryType.SCHEDULED_LEARNINGSLOT){
        title = entry.getTitle();
        if(title.length()>=3){
          r = 70+(int)title.charAt(0);
          g = 20+(int)title.charAt(1);
          b = 100+(int)title.charAt(2);
        }
        else{
          r = 130;
          g = 132;
          b = 176;
        }
        
        println 'color: \'rgb('+r+','+g+','+b+')\',';
      }
  %}
      start: new Date(${entry.getStartDateTime().getYear()},${entry.getStartDateTime().getMonthOfYear()-1},${entry.getStartDateTime().getDayOfMonth()},${entry.getStartDateTime().getHourOfDay()},${entry.getStartDateTime().getMinuteOfHour()}),
      end: new Date(${entry.getEndDateTime().getYear()},${entry.getEndDateTime().getMonthOfYear()-1},${entry.getEndDateTime().getDayOfMonth()},${entry.getEndDateTime().getHourOfDay()},${entry.getEndDateTime().getMinuteOfHour()}),
      allDay: false
    }
  %{
      if(i!=entryList.size()){
        print ',';
      }
    }
  %}      
      ]
    });
    
  });

  </script>   
#{/set}

<div id='calendar'></div>
<br><br>
<table class="table table-hover">
  <thead>
    <tr>
      <th>#</th><th>Entry Title</th><th>Start Date</th><th>End Date</th>
    </tr>
  </thead>
  <tbody>
  %{
    i = 0;
    for(entry in entryList){
      i++; 
  }%
  
  <tr><td>${i}</td><td>${entry.getTitle()}</td><td>${entry.getStartDateTime().toString()}</td><td>${entry.getEndDateTime().toString()}</td></tr>
  
  %{
    }
  }%
  </tbody>
</table>	

${errorString}
<br>

